<html>
<head>
	<title>Catacomb 3-D</title>
	<link rel="icon" type="image/png" href="/favicon.png"/>
	<style>
		body { margin: 0; }
		#cat3d { width: 100%; height: 100%; overflow: hidden; }
		#hud, #menu { position: absolute; left: 0; right: 0; }
		.playing #menu { visibility: hidden; }
		#location {
			color: white;
			font-family: sans-serif;
			font-size: large;
			position: absolute;
			left: 50%;
			transform: translateX(-50%);
		}
	</style>
</head>
<body>
	<div id="cat3d">
		<div id="menu">
			<select id="map-select" name="map">
				<option value="Approach">1. The Approach</option>
				<option value="Nemesis's_Keep">2. Nemesis's Keep</option>
				<option value="Access_Floor">9. Access Floor</option>
			</select>
		</div>
		<div id="hud">
			<span id="location"></span>
		</div>
	</div>
</body>
<script src="cat3d.js"></script>
<script>
const queryParams = {}
location.search.substr(1).split("&").forEach(pair => {
	const tokens = pair.split("=").map(decodeURIComponent)
	queryParams[tokens[0]] = tokens[1]
})

const mapSelect = document.getElementById("map-select")
mapSelect.value = queryParams.map || "Approach"
mapSelect.addEventListener("change", event => {
	location.search = "?map=" + encodeURIComponent(mapSelect.value)
})

const gameContainer = document.getElementById("cat3d")
const gameLocation = document.getElementById("location")
const game = new Catacomb3D.Game(gameContainer, gameLocation, mapSelect.value)
game.resizeView(gameContainer.clientWidth, gameContainer.clientHeight)

let resizeNextFrame = false
window.addEventListener("resize", () => {
	if (!resizeNextFrame) {
		window.requestAnimationFrame(() => {
			game.resizeView(gameContainer.clientWidth, gameContainer.clientHeight)
			resizeNextFrame = false
		})
		resizeNextFrame = true
	}
})

game.renderer.domElement.addEventListener("click", event => {
	game.renderer.domElement.requestPointerLock()
})

game.setup()
</script>
</html>
